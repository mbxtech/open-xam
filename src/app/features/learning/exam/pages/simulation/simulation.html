<div class="min-h-screen bg-default-background p-6">
  @if (exam(); as e) {
    <div class="max-w-4xl mx-auto">
      <ox-card cssClass="p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h1 class="text-heading-1 text-default-font">{{ e.name }}</h1>
            <p class="text-caption text-subtext-color" i18n="@@ox.learning.simulation.currentQuestions">Question {{ currentQuestionIndex() + 1 }} von {{ e.questions.length }}</p>
          </div>
          <ox-button variant="destructive" size="sm" (click)="finishSimulation()" i18n="@@ox.learning.simulation.endSimulation">
            <fa-icon [icon]="faTimes" class="mr-2"></fa-icon>
            End simulation
          </ox-button>
        </div>

        <div class="w-full bg-neutral-100 dark:bg-neutral-200 rounded-full h-2">
          <div 
            class="bg-brand-primary h-2 rounded-full transition-all duration-300" 
            [style.width.%]="progress()"
          ></div>
        </div>
      </ox-card>

      @if (currentQuestion(); as q) {
        <ox-question-view 
          [question]="q"
          [questionResult]="questionAnswers()[q.id!]"
          [viewMode]="viewMode()"
          [confirmed]="isConfirmed()"
          (answerChanged)="handleAnswerChange($event)"
        />
      }

      <div class="flex items-center justify-between mt-8">
        <ox-button 
          variant="outline"
          (click)="previousQuestion()"
          [disabled]="currentQuestionIndex() === 0"
          i18n="@@ox.learning.simulation.btn.previous"
        >
          <fa-icon [icon]="faChevronLeft" class="mr-2"></fa-icon>
          Previous
        </ox-button>

        <div class="flex items-center gap-3">
          @if (!isConfirmed() && viewMode() !== 'realistic') {
            <ox-button 
              (click)="confirmAnswer()"
              i18n="@@ox.learning.simulation.btn.submit"
            >
              <fa-icon [icon]="faCheck" class="mr-2"></fa-icon>
              Submit
            </ox-button>
          } @else if (currentQuestionIndex() < e.questions.length - 1) {
            <ox-button 
              (click)="nextQuestion()"
              i18n="@@ox.learning.simulation.btn.next"
            >
              Next
              <fa-icon [icon]="faChevronRight" class="ml-2"></fa-icon>
            </ox-button>
          } @else {
            <ox-button 
              (click)="finishSimulation()"
              class="bg-success-600 hover:bg-success-700"
              i18n="@@ox.learning.simulation.btn.submitSimulation"
            >
              Finish simulation
              <fa-icon [icon]="faCheck" class="ml-2"></fa-icon>
            </ox-button>
          }
        </div>
      </div>
    </div>
  } @else {
    <div class="flex flex-col items-center justify-center min-h-[400px]">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-primary mb-4"></div>
      <p class="text-subtext-color font-medium" i18n="@@ox.learning.simulation.loading">Loading exam...</p>
    </div>
  }
</div>
