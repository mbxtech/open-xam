<ox-statistics-header />
<ox-exam-overview-controls (searchChange)="searchExams($event)" />

@if (loading$ | async) {
<div class="flex items-center justify-center py-16">
    <svg class="h-8 w-8 animate-spin text-brand-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
    </svg>
</div>
}

@if (!(loading$ | async)) {
@if (exams | async; as vm) {
@if (vm === null) {
<div class="mt-8 rounded-md border border-dashed border-neutral-border p-10 text-center text-subtext-color">
    <p class="mb-4" i18n="@@ox.administration.overview.empty">No entries</p>
    <ox-button (click)="goToEdit()">
        <fa-icon [icon]="faAdd"></fa-icon>
        <span i18n="@@ox.administration.overview.overview.create.first">Create your first exam</span>
    </ox-button>
</div>
} @else {
@for (exam of vm; track exam.id) {
<div class="py-4">
    <ox-card class="hover:shadow-lg transition-shadow">
        <div class="flex items-start justify-between gap-4 p-6 ">
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-heading-3 text-default-font truncate">{{ exam.name }}</h3>
                    <ox-badge variant="primary">{{exam.statusType || 'N/A'}}</ox-badge>
                    @if (exam.category?.name?.length) {
                        <ox-badge variant="secondary" i18n="@@ox.general.category">
                            {{ exam.category!.name }}
                        </ox-badge>
                    }
                </div>
                <p class="text-body text-subtext-color mb-3 line-clamp-2">
                    {{ exam.description }}
                </p>
                <div class="flex flex-wrap gap-4 text-caption text-subtext-color">
                    <div class="flex items-center gap-1">
                        <span class="font-medium text-default-font">{{ exam.questions.length }}</span>
                        <span i18n="@@ox.general.exam.questions">Questions</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="font-medium text-default-font">{{ exam.pointsToSucceeded }}</span>
                        <span i18n="@@ox.general.exam.pointsToSucceed">Points to succeed</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span i18n="@@ox.general.createdAt">Created at: {{ exam.createdAt | date: 'dd.MM.yyyy hh:mm:ss' }}</span>
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <ox-button variant="outline" size="sm" i18n-title="@@ox.general.edit" title="Edit" (click)="goToEdit(exam.id)">
                    <fa-icon class="w-4 h-4" [icon]="faPencil" />
                </ox-button>
                <ox-button variant="outline" size="sm" i18n-title="@@ox.general.delete" title="Delete" (click)="openDelete(exam.id!)">
                    <fa-icon class="w-4 h-4 text-error-500" [icon]="faTrash" />
                </ox-button>
                <ox-button variant="outline" size="sm" i18n-title="@@ox.general.export" title="Export" (click)="exportExams(exam)">
                    <fa-icon class="w-4 h-4 text-primary-500" [icon]="faExport" />
                </ox-button>
            </div>
        </div>
    </ox-card>
</div>
}

<ox-pagination-controls (pageOptions)="onPageChanged($event)" [pagedResult]="currentPagedResultSignal()" />
}
}
}

<ox-dialog [isOpen]="isDeleteOpen()">
    <ox-dialog-header>
        <h1 i18n="@@ox.administration.overview.deleteExamDialog.title">Delete Exam</h1>
    </ox-dialog-header>
    <ox-dialog-content>
        <p i18n="@@ox.administration.overview.deleteExamDialog.message">Are you sure you want to delete this exam? All associated data will be permanently removed and can not be restored. This action cannot be undone.</p>
    </ox-dialog-content>
    <ox-dialog-footer>
        <ox-button variant="outline" (click)="isDeleteOpen.set(false)">
            Close
        </ox-button>
        <ox-button variant="outline" (click)="confirmDelete()">
            Delete
        </ox-button>
    </ox-dialog-footer>
</ox-dialog>